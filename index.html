<!doctype html>
<html class="no-js" lang="en" data-content_root="./">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" /><link rel="next" title="Getting started" href="getting_started.html" />

    <!-- Generated with Sphinx 8.1.3 and Furo 2024.08.06 -->
        <title>iss-preprocess 0.2.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?v=302659d7" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="#"><div class="brand">iss-preprocess 0.2.1 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="#">
  
  
  <span class="sidebar-brand-text">iss-preprocess 0.2.1 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="project_and_average.html">Crunch the data</a></li>
<li class="toctree-l1"><a class="reference internal" href="registration.html">Registration</a></li>
<li class="toctree-l1"><a class="reference internal" href="call.html">Calling spots</a></li>
<li class="toctree-l1"><a class="reference internal" href="correction.html">Channel brightness and illumination correction</a></li>
<li class="toctree-l1"><a class="reference internal" href="bleedthrough.html">Bleedthrough matrix estimation</a></li>
<li class="toctree-l1"><a class="reference internal" href="sequencing.html">Calling various spots</a></li>
<li class="toctree-l1"><a class="reference internal" href="hybridisation.html">Detecting hybridisation spots</a></li>
<li class="toctree-l1"><a class="reference internal" href="segmentation.html">Cell segmentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="detect_mcherry.html">Detection mCherry cells</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API reference:</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="iss_preprocess.html">iss_preprocess package</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of iss_preprocess package</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="iss_preprocess.call.html">iss_preprocess.call package</a></li>
<li class="toctree-l2"><a class="reference internal" href="iss_preprocess.config.html">iss_preprocess.config package</a></li>
<li class="toctree-l2"><a class="reference internal" href="iss_preprocess.coppafish.html">iss_preprocess.coppafish package</a></li>
<li class="toctree-l2"><a class="reference internal" href="iss_preprocess.diagnostics.html">iss_preprocess.diagnostics package</a></li>
<li class="toctree-l2"><a class="reference internal" href="iss_preprocess.image.html">iss_preprocess.image package</a></li>
<li class="toctree-l2"><a class="reference internal" href="iss_preprocess.io.html">iss_preprocess.io package</a></li>
<li class="toctree-l2"><a class="reference internal" href="iss_preprocess.pipeline.html">iss_preprocess.pipeline package</a></li>
<li class="toctree-l2"><a class="reference internal" href="iss_preprocess.reg.html">iss_preprocess.reg package</a></li>
<li class="toctree-l2"><a class="reference internal" href="iss_preprocess.segment.html">iss_preprocess.segment package</a></li>
<li class="toctree-l2"><a class="reference internal" href="iss_preprocess.vis.html">iss_preprocess.vis package</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="flowchart_legends.html">Flowcharts legends</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="_sources/index.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="welcome-to-iss-preprocess-s-documentation">
<h1>Welcome to iss-preprocess’s documentation!<a class="headerlink" href="#welcome-to-iss-preprocess-s-documentation" title="Link to this heading">¶</a></h1>
<div class="toctree-wrapper compound">
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="getting_started.html#data-organisation">Data organisation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="project_and_average.html">Crunch the data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="project_and_average.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="project_and_average.html#details">Details</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="registration.html">Registration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="registration.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="registration.html#register-sequencing-acquisitions">Register Sequencing acquisitions</a></li>
<li class="toctree-l2"><a class="reference internal" href="registration.html#registering-sequencing-rounds">Registering sequencing rounds</a></li>
<li class="toctree-l2"><a class="reference internal" href="registration.html#detailed-explanation-part-1-estimating-angle-scale-and-shift">Detailed explanation part 1: Estimating angle, scale and shift</a></li>
<li class="toctree-l2"><a class="reference internal" href="registration.html#detailed-explanation-part-2-stitching-tiles">Detailed explanation part 2: Stitching tiles</a></li>
<li class="toctree-l2"><a class="reference internal" href="registration.html#registering-acquisition-together">Registering acquisition together</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="call.html">Calling spots</a><ul>
<li class="toctree-l2"><a class="reference internal" href="call.html#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="call.html#calling-genes">Calling genes</a></li>
<li class="toctree-l2"><a class="reference internal" href="call.html#calling-barcodes">Calling barcodes</a></li>
<li class="toctree-l2"><a class="reference internal" href="call.html#calling-hybridisation-spots">Calling hybridisation spots</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="correction.html">Channel brightness and illumination correction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="correction.html#channel-brightness">Channel brightness</a></li>
<li class="toctree-l2"><a class="reference internal" href="correction.html#illumination-correction">Illumination correction</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="bleedthrough.html">Bleedthrough matrix estimation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="bleedthrough.html#setup-barcode-calling">Setup barcode calling</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="sequencing.html">Calling various spots</a><ul>
<li class="toctree-l2"><a class="reference internal" href="sequencing.html#detecting-and-decoding-gene-spots">Detecting and decoding gene spots</a></li>
<li class="toctree-l2"><a class="reference internal" href="sequencing.html#detecting-and-basecalling-barcode-spots">Detecting and basecalling barcode spots</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="hybridisation.html">Detecting hybridisation spots</a></li>
<li class="toctree-l1"><a class="reference internal" href="segmentation.html">Cell segmentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="detect_mcherry.html">Detection mCherry cells</a><ul>
<li class="toctree-l2"><a class="reference internal" href="detect_mcherry.html#prerequisite">Prerequisite</a></li>
<li class="toctree-l2"><a class="reference internal" href="detect_mcherry.html#automatic-detection">Automatic detection</a></li>
</ul>
</li>
</ul>
</div>
<div class="toctree-wrapper compound">
<p class="caption" role="heading"><span class="caption-text">API reference:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="iss_preprocess.html">iss_preprocess package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="iss_preprocess.html#subpackages">Subpackages</a><ul>
<li class="toctree-l3"><a class="reference internal" href="iss_preprocess.call.html">iss_preprocess.call package</a></li>
<li class="toctree-l3"><a class="reference internal" href="iss_preprocess.config.html">iss_preprocess.config package</a></li>
<li class="toctree-l3"><a class="reference internal" href="iss_preprocess.coppafish.html">iss_preprocess.coppafish package</a></li>
<li class="toctree-l3"><a class="reference internal" href="iss_preprocess.diagnostics.html">iss_preprocess.diagnostics package</a></li>
<li class="toctree-l3"><a class="reference internal" href="iss_preprocess.image.html">iss_preprocess.image package</a></li>
<li class="toctree-l3"><a class="reference internal" href="iss_preprocess.io.html">iss_preprocess.io package</a></li>
<li class="toctree-l3"><a class="reference internal" href="iss_preprocess.pipeline.html">iss_preprocess.pipeline package</a></li>
<li class="toctree-l3"><a class="reference internal" href="iss_preprocess.reg.html">iss_preprocess.reg package</a></li>
<li class="toctree-l3"><a class="reference internal" href="iss_preprocess.segment.html">iss_preprocess.segment package</a></li>
<li class="toctree-l3"><a class="reference internal" href="iss_preprocess.vis.html">iss_preprocess.vis package</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="iss_preprocess.html#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="iss_preprocess.html#module-iss_preprocess.cli">iss_preprocess.cli module</a></li>
<li class="toctree-l2"><a class="reference internal" href="iss_preprocess.html#module-iss_preprocess">Module contents</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="flowchart_legends.html">Flowcharts legends</a></li>
</ul>
</div>
</section>
<section id="iss-preprocess">
<h1>ISS-preprocess<a class="headerlink" href="#iss-preprocess" title="Link to this heading">¶</a></h1>
<p>Utilities for image import, registration, spot localisation and base-calling for ISS data sets.</p>
<section id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Link to this heading">¶</a></h2>
<p>First, clone the repository:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">git</span><span class="nd">@github</span><span class="o">.</span><span class="n">com</span><span class="p">:</span><span class="n">znamlab</span><span class="o">/</span><span class="n">iss</span><span class="o">-</span><span class="n">preprocess</span><span class="o">.</span><span class="n">git</span>
</pre></div>
</div>
<p>Next, navigate to the repo directory and create a conda environment and install dependencies by running:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conda</span> <span class="n">env</span> <span class="n">create</span> <span class="o">--</span><span class="n">name</span> <span class="n">iss</span><span class="o">-</span><span class="n">preprocess</span> <span class="n">python</span><span class="o">=</span><span class="mf">3.10</span>
</pre></div>
</div>
<p>Finally, activate the new environment and install the package itself:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conda</span> <span class="n">activate</span> <span class="n">iss</span><span class="o">-</span><span class="n">preprocess</span>
<span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">e</span> <span class="o">.</span>
</pre></div>
</div>
</section>
<section id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Link to this heading">¶</a></h2>
<p>The main workflow is as follows:</p>
<pre  class="mermaid">
        ---
config:
  layout: elk
---
flowchart TD
 subgraph s1[&quot;Call spots&quot;]
        F[&quot;iss call --genes&quot;]
        G[&quot;iss call --barcodes&quot;]
        E[&quot;iss call --hybridisation&quot;]
  end
    start[&quot;Collect data&quot;] --&gt; A[&quot;iss project-and-average&quot;]
    A --&gt; B[&quot;iss register&quot;]
    B --&gt; E &amp; F &amp; G &amp; S[&quot;iss segment&quot;]
    F --&gt; H[&quot;iss register-to-ref&quot;]
    G --&gt; H
    E --&gt; H
    S --&gt; H
style A fill:#424242,stroke:#616161,color:#00C853
style B fill:#424242,stroke:#616161,color:#00C853
style S fill:#424242,stroke:#616161,color:#00C853
style E fill:#424242,stroke:#616161,color:#00C853
style F fill:#424242,stroke:#616161,color:#00C853
style G fill:#424242,stroke:#616161,color:#00C853
style H fill:#424242,stroke:#616161,color:#00C853
style s1 fill:#757575,color:#C8E6C9
    </pre><p>For more information on the individual steps, see the <a class="reference external" href="https://iss-preprocess.znamlab.org/">documentation</a>.</p>
</section>
<section id="getting-started">
<h2>Getting started<a class="headerlink" href="#getting-started" title="Link to this heading">¶</a></h2>
<p>To get started see the flexiznam documentation at <a class="reference external" href="https://flexiznam.znamlab.org/">https://flexiznam.znamlab.org/</a>, in particular the “initial configuration” section.</p>
<p>Then refer to the <a class="reference external" href="https://iss-preprocess.znamlab.org/">getting started page of the documentation</a> for more information.</p>
</section>
<section id="development">
<h2> Development<a class="headerlink" href="#development" title="Link to this heading">¶</a></h2>
<section id="building-the-documentation">
<h3>Building the documentation<a class="headerlink" href="#building-the-documentation" title="Link to this heading">¶</a></h3>
<p>To build the documentation you need to install extra dependencies, either by running:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">e</span> <span class="o">.</span><span class="p">[</span><span class="n">dev</span><span class="p">]</span>
</pre></div>
</div>
<p>or using the requirement file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">r</span> <span class="n">docs</span><span class="o">/</span><span class="n">requirements</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
<p>Then you can build the documentation locally by running:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sphinx</span><span class="o">-</span><span class="n">build</span> <span class="n">docs</span><span class="o">/</span><span class="n">source</span> <span class="n">docs</span><span class="o">/</span><span class="n">build</span>
</pre></div>
</div>
</section>
<section id="atlas-cache">
<h3>Atlas cache<a class="headerlink" href="#atlas-cache" title="Link to this heading">¶</a></h3>
<p>The registration to the allen reference atlas uses <code class="docutils literal notranslate"><span class="pre">bg_atlasapi</span></code> from brainglobe. This
keeps a cached version of the atlas in <code class="docutils literal notranslate"><span class="pre">~/.brainglobe</span></code> by default. This can be quite
big for high resolution atlases (10um per pixel). If using <code class="docutils literal notranslate"><span class="pre">nemo</span></code>, you might consider
linking that folder to save space in your home directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="o">/</span><span class="n">camp</span><span class="o">/</span><span class="n">lab</span><span class="o">/</span><span class="n">znamenskiyp</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">users</span><span class="o">/&lt;</span><span class="n">your</span> <span class="n">user</span> <span class="n">name</span><span class="o">&gt;/</span><span class="n">brainglobe</span>
<span class="n">ln</span> <span class="o">-</span><span class="n">s</span> <span class="o">/</span><span class="n">camp</span><span class="o">/</span><span class="n">lab</span><span class="o">/</span><span class="n">znamenskiyp</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">users</span><span class="o">/&lt;</span><span class="n">your</span> <span class="n">user</span> <span class="n">name</span><span class="o">&gt;/</span><span class="n">brainglobe</span> <span class="o">.</span><span class="n">brainglobe</span>
</pre></div>
</div>
</section>
</section>
<section id="organisation-of-this-repository">
<h2>Organisation of this repository<a class="headerlink" href="#organisation-of-this-repository" title="Link to this heading">¶</a></h2>
<p>The purpose of this repo is to house scripts that will be used to preprocess image-based ISS data sets of multiple flavours (BARseq, INSTAseq etc.)</p>
<p>The broad strokes of the pipeline are:</p>
<ul class="simple">
<li><p>Estimation of illumination and channel brightness correction</p></li>
<li><p>Registration of images between rounds of sequencing</p></li>
<li><p>Estimation of bleedthrough matrices for sequencing and hybridisation rounds</p></li>
<li><p>Localisation of spots across rounds</p></li>
<li><p>Base-calling for each spot</p></li>
<li><p>Alignment of spots across tiles and acquisitions (genes, hybridisation rounds, barcodes) into a global coordinate system</p></li>
<li><p>Cell segmentation based on DAPI images</p></li>
<li><p>Construction of a cell-barcode matrix</p></li>
</ul>
</section>
<section id="subpackages">
<h2>Subpackages<a class="headerlink" href="#subpackages" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">io</span></code> - input and saving of image data and related metadata</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">reg</span></code> - code for stitching and registering images between rounds of sequencing</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">image</span></code> - image processing and correction routines</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">segment</span></code> - detecting ROIs and rolonies</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">call</span></code> - base-calling across rounds and constructing the cell/genes/barcode matrix output</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">config</span></code> - contains default pipeline settings</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">coppafish</span></code> - utilities adapted from coppafish codebase: hanning window, annulus for isolated
spot detection, and scaled k-means for bleedthrough estimation</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pipeline</span></code> - high level routines for batch processing</p></li>
</ul>
</section>
<section id="omp-pipeline">
<h2>OMP pipeline<a class="headerlink" href="#omp-pipeline" title="Link to this heading">¶</a></h2>
<p>The pipeline uses orthogonal matching pursuit to identify gene rolonies. The approach
is loosely based on that used in this preprint <a class="reference external" href="https://www.biorxiv.org/content/10.1101/2021.10.24.465600v4">https://www.biorxiv.org/content/10.1101/2021.10.24.465600v4</a>
and implemented in <a class="reference external" href="https://github.com/jduffield65/iss">https://github.com/jduffield65/iss</a>.</p>
<p>First, bright rolonies are identified by looking for spots in a STD projection
of a sequencing round. The average fluorescence of each spot is fed into a simple
base caller, which uses a Gaussian Mixture Model to classify the 4 bases.</p>
<p>Sequences for each spot are them compared to a codebook to assign spots to genes.
Spots matching each gene (by default without any mismatches) are used to create
a dictionary to be used for Orthogonal Matching Pursuit.</p>
<p>OMP is then applied to each pixel to identify the genes present.
The algorithm works by iteratively. At each step we find the component that has
the highest dot product with the residual fluorescence signal. After selecting
a component, coefficients for all included components are estimated by least
squares regression and the residuals are updated. The component is retained
if it reduces the norm of the residuals by at least a fraction of the original
norm specified by a tolerance parameter.</p>
<p>The end product of the OMP algorithm is a series of images, containing coefficients
for each gene. We can now detect peaks in these images to find the location of
individual gene rolonies.</p>
</section>
<section id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Link to this heading">¶</a></h2>
<p>Examples can be found in the <code class="docutils literal notranslate"><span class="pre">notebooks</span></code> subdirectory.</p>
</section>
</section>
<section id="indices-and-tables">
<h1>Indices and tables<a class="headerlink" href="#indices-and-tables" title="Link to this heading">¶</a></h1>
<ul class="simple">
<li><p><a class="reference internal" href="genindex.html"><span class="std std-ref">Index</span></a></p></li>
<li><p><a class="reference internal" href="py-modindex.html"><span class="std std-ref">Module Index</span></a></p></li>
<li><p><a class="reference internal" href="search.html"><span class="std std-ref">Search Page</span></a></p></li>
</ul>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="getting_started.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Getting started</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2023, Znamenskiy lab
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script src="_static/documentation_options.js?v=37f418d5"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/furo.js?v=5fa4622c"></script>
    <script type="module" src="https://cdn.jsdelivr.net/npm/mermaid@11.2.0/dist/mermaid.esm.min.mjs"></script>
    <script type="module" src="https://cdn.jsdelivr.net/npm/@mermaid-js/layout-elk@0.1.4/dist/mermaid-layout-elk.esm.min.mjs"></script>
    <script type="module">import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@11.2.0/dist/mermaid.esm.min.mjs";import elkLayouts from "https://cdn.jsdelivr.net/npm/@mermaid-js/layout-elk@0.1.4/dist/mermaid-layout-elk.esm.min.mjs";mermaid.registerLayoutLoaders(elkLayouts);mermaid.initialize({startOnLoad:false});</script>
    <script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script>
    <script type="module">
import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@11.2.0/dist/mermaid.esm.min.mjs";
window.addEventListener("load", () => mermaid.run());
</script>
    </body>
</html>
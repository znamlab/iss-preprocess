<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />
<link rel="index" title="Index" href="genindex.html" /><link rel="search" title="Search" href="search.html" />

    <!-- Generated with Sphinx 6.1.3 and Furo 2022.12.07 -->
        <title>iss_preprocess.call package - iss-preprocess 0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?digest=91d0f0d1c444bdcb17a68e833c7a53903343c195" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">iss-preprocess 0.1 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  
  <span class="sidebar-brand-text">iss-preprocess 0.1 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  
</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="iss-preprocess-call-package">
<h1>iss_preprocess.call package<a class="headerlink" href="#iss-preprocess-call-package" title="Permalink to this heading">#</a></h1>
<section id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Permalink to this heading">#</a></h2>
</section>
<section id="module-iss_preprocess.call.call">
<span id="iss-preprocess-call-call-module"></span><h2>iss_preprocess.call.call module<a class="headerlink" href="#module-iss_preprocess.call.call" title="Permalink to this heading">#</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="iss_preprocess.call.call.basecall_rois">
<span class="sig-prename descclassname"><span class="pre">iss_preprocess.call.call.</span></span><span class="sig-name descname"><span class="pre">basecall_rois</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rois</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">separate_rounds</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rounds</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">()</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nsamples</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#iss_preprocess.call.call.basecall_rois" title="Permalink to this definition">#</a></dt>
<dd><p>Assign bases using a Gaussian Mixture Model.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>rois</strong> (<em>list</em>) – list of ROI objects.</p></li>
<li><p><strong>separate_rounds</strong> (<em>bool</em>) – whether to run basecalling separately on each
round or on all rounds together. Default True.</p></li>
<li><p><strong>rounds</strong> – numpy.array of rounds to include.</p></li>
<li><p><strong>nsamples</strong> (<em>int</em>) – number of samples to include for fitting GMM. If None,
all data are used for fitting. Default None.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>ROIs x rounds of base IDs.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="iss_preprocess.call.call.call_genes">
<span class="sig-prename descclassname"><span class="pre">iss_preprocess.call.call.</span></span><span class="sig-name descname"><span class="pre">call_genes</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sequences</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">codebook</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#iss_preprocess.call.call.call_genes" title="Permalink to this definition">#</a></dt>
<dd><p>Assigns sequences to genes based on the provided codebook.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>sequences</strong> (<em>numpy.ndarray</em>) – ROIs x rounds array of base IDs generated by
<cite>basecall_rois</cite>.</p></li>
<li><p><strong>codebook</strong> (<em>pandas.DataFrame</em>) – gene codes, containing ‘gii’, ‘seq’, and ‘gene’
columns.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>List of most closely matching gene names.
List of edit distances.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="iss_preprocess.call.call.correct_barcode_sequences">
<span class="sig-prename descclassname"><span class="pre">iss_preprocess.call.call.</span></span><span class="sig-name descname"><span class="pre">correct_barcode_sequences</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">spots</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_edit_distance</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#iss_preprocess.call.call.correct_barcode_sequences" title="Permalink to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="iss_preprocess.call.call.extract_spots">
<span class="sig-prename descclassname"><span class="pre">iss_preprocess.call.call.</span></span><span class="sig-name descname"><span class="pre">extract_spots</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">spots</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stack</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#iss_preprocess.call.call.extract_spots" title="Permalink to this definition">#</a></dt>
<dd><p>Extract fluorescence traces of spots and assign them to a column of the DataFrame.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>spots</strong> (<em>pandas.DataFrame</em>) – </p></li>
<li><p><strong>stack</strong> (<em>numpy.ndarray</em>) – X x Y x C x R stack.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><dl class="simple">
<dt>same as input with a new “traces” column containing</dt><dd><p>a R x C array of fluorescence value</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>spots (pandas.DataFrame)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="iss_preprocess.call.call.get_cluster_means">
<span class="sig-prename descclassname"><span class="pre">iss_preprocess.call.call.</span></span><span class="sig-name descname"><span class="pre">get_cluster_means</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">spots</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vis</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">score_thresh</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#iss_preprocess.call.call.get_cluster_means" title="Permalink to this definition">#</a></dt>
<dd><p>Find the mean of the 4 clusters (one per channel)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>spots</strong> (<em>pandas.DataFrame</em>) – Dataframe of extracted spot.</p></li>
<li><p><strong>vis</strong> (<em>bool</em><em>, </em><em>optional</em>) – Plot clusters and means. Defaults to False.</p></li>
<li><p><strong>score_thresh</strong> (<em>float</em><em>, </em><em>optional</em>) – score_thresh arguments for scaled_k_means.
Scalar between 0 and 1. To give a different score for each cluster, give
a list of Nc floats. Only points with dot product to a cluster mean vector
greater than this contribute to new estimate of mean vector. Defaults to 0.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><dl class="simple">
<dt>A list with Nrounds elements. Each a Nch x Ncl (square</dt><dd><p>because N channels is equal to N clusters) array of cluster means,
normalised by round 0 intensity</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>cluster_means (list)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="iss_preprocess.call.call.rois_to_array">
<span class="sig-prename descclassname"><span class="pre">iss_preprocess.call.call.</span></span><span class="sig-name descname"><span class="pre">rois_to_array</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rois</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">normalize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#iss_preprocess.call.call.rois_to_array" title="Permalink to this definition">#</a></dt>
<dd></dd></dl>

</section>
<section id="module-iss_preprocess.call.omp">
<span id="iss-preprocess-call-omp-module"></span><h2>iss_preprocess.call.omp module<a class="headerlink" href="#module-iss_preprocess.call.omp" title="Permalink to this heading">#</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="iss_preprocess.call.omp.barcode_spots_dot_product">
<span class="sig-prename descclassname"><span class="pre">iss_preprocess.call.omp.</span></span><span class="sig-name descname"><span class="pre">barcode_spots_dot_product</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">spots</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cluster_means</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">norm_shift</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sequence_column</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'sequence'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#iss_preprocess.call.omp.barcode_spots_dot_product" title="Permalink to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="iss_preprocess.call.omp.make_background_vectors">
<span class="sig-prename descclassname"><span class="pre">iss_preprocess.call.omp.</span></span><span class="sig-name descname"><span class="pre">make_background_vectors</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">nrounds</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">7</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">nchannels</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">4</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#iss_preprocess.call.omp.make_background_vectors" title="Permalink to this definition">#</a></dt>
<dd><p>Create background vectors for OMP algorithm. There is one vector for each channel.
Each vector has fluorescence in one channel across all rounds. Vectors are
normalized to have unit norm.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>nrounds</strong> (<em>int</em>) – number of rounds</p></li>
<li><p><strong>nchannels</strong> (<em>int</em>) – number of channels.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>round x channel numpy.ndarray of background vectors.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="iss_preprocess.call.omp.make_gene_templates">
<span class="sig-prename descclassname"><span class="pre">iss_preprocess.call.omp.</span></span><span class="sig-name descname"><span class="pre">make_gene_templates</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cluster_means</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">codebook</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vis</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#iss_preprocess.call.omp.make_gene_templates" title="Permalink to this definition">#</a></dt>
<dd><p>Make dictionary of fluorescence values for each gene by finding well-matching
spots.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>rois</strong> (<em>list</em>) – list of ROI objects containing fluorescence traces</p></li>
<li><p><strong>codebook</strong> (<em>pandas.DataFrame</em>) – gene codes, containing ‘gii’, ‘seq’, and ‘gene’
columns.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><dl class="simple">
<dt>N x genes numpy.ndarray containing dictionary of fluorescence values for</dt><dd><p>each gene.</p>
</dd>
</dl>
<p>List of detected gene names.</p>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="iss_preprocess.call.omp.omp">
<span class="sig-prename descclassname"><span class="pre">iss_preprocess.call.omp.</span></span><span class="sig-name descname"><span class="pre">omp</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">X</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">background_vectors</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_comp</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tol</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.05</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#iss_preprocess.call.omp.omp" title="Permalink to this definition">#</a></dt>
<dd><p>Run Orthogonal Matching Pursuit to identify components present in the input
signal.</p>
<p>The algorithm works by iteratively. At each step we find the component that has
the highest dot product with the residual of the input signal. After selecting
a component, coefficients for all included components are estimated by least
squares regression and the residuals are updated. The component is retained
if it reduces the norm of the residuals by at least a fraction of the original
norm specified by the tolerance parameter.</p>
<p>Background vectors are automatically included.</p>
<p>Algorithm stops when the tolerance threshold is reach or the number of
components reaches <cite>max_comp</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>y</strong> (<em>numpy.ndarray</em>) – length N input signal.</p></li>
<li><p><strong>X</strong> (<em>numpy.ndarray</em>) – N x M dictionary of M components.</p></li>
<li><p><strong>background_vectors</strong> (<em>numpy.ndarray</em>) – N x O dictionary of background components.</p></li>
<li><p><strong>max_comp</strong> (<em>int</em>) – maximum number of components to include.</p></li>
<li><p><strong>tol</strong> (<em>float</em>) – tolerance threshold that determines the minimum fraction of
the residual norm to retain a component.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Length M + O array of component coefficients
Length N array of residuals</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="iss_preprocess.call.omp.omp_weighted">
<span class="sig-prename descclassname"><span class="pre">iss_preprocess.call.omp.</span></span><span class="sig-name descname"><span class="pre">omp_weighted</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">X</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">background_vectors</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_comp</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tol</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.05</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alpha</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">120.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">beta_squared</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weighted</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">refit_background</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">norm_shift</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#iss_preprocess.call.omp.omp_weighted" title="Permalink to this definition">#</a></dt>
<dd><p>Run Orthogonal Matching Pursuit to identify components present in the input
signal.</p>
<p>The algorithm works by iteratively. At each step we find the component that has
the highest dot product with the residual of the input signal. After selecting
a component, coefficients for all included components are estimated by least
squares regression and the residuals are updated. The component is retained
if it reduces the norm of the residuals by at least a fraction of the original
norm specified by the tolerance parameter.</p>
<p>Background vectors are automatically included.</p>
<p>Algorithm stops when the tolerance threshold is reach or the number of
components reaches <cite>max_comp</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>y</strong> (<em>numpy.ndarray</em>) – length N input signal.</p></li>
<li><p><strong>X</strong> (<em>numpy.ndarray</em>) – N x M dictionary of M components.</p></li>
<li><p><strong>background_vectors</strong> (<em>numpy.ndarray</em>) – N x O dictionary of background components.</p></li>
<li><p><strong>max_comp</strong> (<em>int</em>) – maximum number of components to include.</p></li>
<li><p><strong>tol</strong> (<em>float</em>) – tolerance threshold that determines the minimum fraction of
the residual norm to retain a component.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Length M + O array of component coefficients
Length N array of residuals</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="iss_preprocess.call.omp.refine_gene_templates">
<span class="sig-prename descclassname"><span class="pre">iss_preprocess.call.omp.</span></span><span class="sig-name descname"><span class="pre">refine_gene_templates</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">rois</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gene_dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">unique_genes</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">thresh</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.8</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">vis</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#iss_preprocess.call.omp.refine_gene_templates" title="Permalink to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="iss_preprocess.call.omp.run_omp">
<span class="sig-prename descclassname"><span class="pre">iss_preprocess.call.omp.</span></span><span class="sig-name descname"><span class="pre">run_omp</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">stack</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gene_dict</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tol</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.05</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weighted</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">refit_background</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">alpha</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">120.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">beta_squared</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">norm_shift</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_comp</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_intensity</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#iss_preprocess.call.omp.run_omp" title="Permalink to this definition">#</a></dt>
<dd><p>Apply the OMP algorithm to every pixel of the provided image stack.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>stack</strong> (<em>numpy.ndarray</em>) – X x Y x C x R image stack.</p></li>
<li><p><strong>gene_dict</strong> (<em>numpy.ndarray</em>) – N x M dictionary, where N = R * C and M is the
number of genes.</p></li>
<li><p><strong>tol</strong> (<em>float</em>) – tolerance threshold for OMP algorithm.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>Gene coefficient matrix of shape X x Y x M
Background coefficient matrix of shape X x Y x C
Residual stack, shape X x Y x (R * C)</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-iss_preprocess.call.spot_shape">
<span id="iss-preprocess-call-spot-shape-module"></span><h2>iss_preprocess.call.spot_shape module<a class="headerlink" href="#module-iss_preprocess.call.spot_shape" title="Permalink to this heading">#</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="iss_preprocess.call.spot_shape.apply_symmetry">
<span class="sig-prename descclassname"><span class="pre">iss_preprocess.call.spot_shape.</span></span><span class="sig-name descname"><span class="pre">apply_symmetry</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">spot_sign_image</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#iss_preprocess.call.spot_shape.apply_symmetry" title="Permalink to this definition">#</a></dt>
<dd><p>Generates a circularly symmetric spot image by averaging pixels at the same distance from the centre.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>spot_sign_image</strong> (<em>numpy.ndarray</em>) – inputs spot image</p>
</dd>
</dl>
<p>Returns:
numpy.ndarray: circularly s</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="iss_preprocess.call.spot_shape.detect_spots_by_shape">
<span class="sig-prename descclassname"><span class="pre">iss_preprocess.call.spot_shape.</span></span><span class="sig-name descname"><span class="pre">detect_spots_by_shape</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">im</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spot_sign_image</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rho</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#iss_preprocess.call.spot_shape.detect_spots_by_shape" title="Permalink to this definition">#</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="iss_preprocess.call.spot_shape.find_gene_spots">
<span class="sig-prename descclassname"><span class="pre">iss_preprocess.call.spot_shape.</span></span><span class="sig-name descname"><span class="pre">find_gene_spots</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">g</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spot_sign_image</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rho</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spot_score_threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.05</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#iss_preprocess.call.spot_shape.find_gene_spots" title="Permalink to this definition">#</a></dt>
<dd><p>Finds gene spots based on similarity to the spot sign image.</p>
<p>We first detect spots by finding peaks in the OMP out put images. For each
spot we compute a score based on its similarity with average spot sign image.
This score is defined as</p>
<blockquote>
<div><p>(n_neg + rho * n_pos) / (max_neg + rho * max_pos)</p>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>g</strong> (<em>numpy.ndarray</em>) – X x Y x Ngenes OMP output</p></li>
<li><p><strong>spot_sign_image</strong> (<em>numpy.ndarray</em>) – average spot sign image to use as a template in filtering spots</p></li>
<li><p><strong>rho</strong> (<em>float</em>) – multiplier that defines the relative weight assigned to positive spot pixels.
Default: 2.</p></li>
<li><p><strong>spot_score_threshold</strong> (<em>float</em>) – minimum score threshold for including spots.
Default: 0.05</p></li>
</ul>
</dd>
</dl>
<p>Returns:</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="iss_preprocess.call.spot_shape.get_spot_shape">
<span class="sig-prename descclassname"><span class="pre">iss_preprocess.call.spot_shape.</span></span><span class="sig-name descname"><span class="pre">get_spot_shape</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">g</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spot_xy</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">7</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">neighbor_filter_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">9</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">neighbor_threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">15</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#iss_preprocess.call.spot_shape.get_spot_shape" title="Permalink to this definition">#</a></dt>
<dd><p>Get average spot shape.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>g</strong> (<em>numpy.ndarray</em>) – X x Y x Ngenes OMP output</p></li>
<li><p><strong>spot_xy</strong> (<em>int</em>) – spot radius to extract</p></li>
<li><p><strong>neighbor_filter_size</strong> (<em>int</em>) – size of the square filter used for counting pixels in initial spot selection</p></li>
<li><p><strong>neighbor_threshold</strong> (<em>int</em>) – minimum number of positive pixels for a spot to be included in the average</p></li>
</ul>
</dd>
</dl>
<p>Returns:
numpy.ndarray: (spot_xy + 1) x (spot_xy+1) mean spot image.</p>
</dd></dl>

</section>
<section id="module-iss_preprocess.call">
<span id="module-contents"></span><h2>Module contents<a class="headerlink" href="#module-iss_preprocess.call" title="Permalink to this heading">#</a></h2>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2023, Znamenskiy lab
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">iss_preprocess.call package</a><ul>
<li><a class="reference internal" href="#submodules">Submodules</a></li>
<li><a class="reference internal" href="#module-iss_preprocess.call.call">iss_preprocess.call.call module</a><ul>
<li><a class="reference internal" href="#iss_preprocess.call.call.basecall_rois"><code class="docutils literal notranslate"><span class="pre">basecall_rois()</span></code></a></li>
<li><a class="reference internal" href="#iss_preprocess.call.call.call_genes"><code class="docutils literal notranslate"><span class="pre">call_genes()</span></code></a></li>
<li><a class="reference internal" href="#iss_preprocess.call.call.correct_barcode_sequences"><code class="docutils literal notranslate"><span class="pre">correct_barcode_sequences()</span></code></a></li>
<li><a class="reference internal" href="#iss_preprocess.call.call.extract_spots"><code class="docutils literal notranslate"><span class="pre">extract_spots()</span></code></a></li>
<li><a class="reference internal" href="#iss_preprocess.call.call.get_cluster_means"><code class="docutils literal notranslate"><span class="pre">get_cluster_means()</span></code></a></li>
<li><a class="reference internal" href="#iss_preprocess.call.call.rois_to_array"><code class="docutils literal notranslate"><span class="pre">rois_to_array()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-iss_preprocess.call.omp">iss_preprocess.call.omp module</a><ul>
<li><a class="reference internal" href="#iss_preprocess.call.omp.barcode_spots_dot_product"><code class="docutils literal notranslate"><span class="pre">barcode_spots_dot_product()</span></code></a></li>
<li><a class="reference internal" href="#iss_preprocess.call.omp.make_background_vectors"><code class="docutils literal notranslate"><span class="pre">make_background_vectors()</span></code></a></li>
<li><a class="reference internal" href="#iss_preprocess.call.omp.make_gene_templates"><code class="docutils literal notranslate"><span class="pre">make_gene_templates()</span></code></a></li>
<li><a class="reference internal" href="#iss_preprocess.call.omp.omp"><code class="docutils literal notranslate"><span class="pre">omp()</span></code></a></li>
<li><a class="reference internal" href="#iss_preprocess.call.omp.omp_weighted"><code class="docutils literal notranslate"><span class="pre">omp_weighted()</span></code></a></li>
<li><a class="reference internal" href="#iss_preprocess.call.omp.refine_gene_templates"><code class="docutils literal notranslate"><span class="pre">refine_gene_templates()</span></code></a></li>
<li><a class="reference internal" href="#iss_preprocess.call.omp.run_omp"><code class="docutils literal notranslate"><span class="pre">run_omp()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-iss_preprocess.call.spot_shape">iss_preprocess.call.spot_shape module</a><ul>
<li><a class="reference internal" href="#iss_preprocess.call.spot_shape.apply_symmetry"><code class="docutils literal notranslate"><span class="pre">apply_symmetry()</span></code></a></li>
<li><a class="reference internal" href="#iss_preprocess.call.spot_shape.detect_spots_by_shape"><code class="docutils literal notranslate"><span class="pre">detect_spots_by_shape()</span></code></a></li>
<li><a class="reference internal" href="#iss_preprocess.call.spot_shape.find_gene_spots"><code class="docutils literal notranslate"><span class="pre">find_gene_spots()</span></code></a></li>
<li><a class="reference internal" href="#iss_preprocess.call.spot_shape.get_spot_shape"><code class="docutils literal notranslate"><span class="pre">get_spot_shape()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-iss_preprocess.call">Module contents</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/scripts/furo.js"></script>
    </body>
</html>